<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultado del Diagn√≥stico</title>
    <link rel="stylesheet" href="/static/styles.css?v=2.4">
</head>
<body>
    <div class="container">
    <!-- Logo SmartSolve en esquina -->
    <img src="/imgs/SmartSolve.jpeg" alt="SmartSolve" class="corner-logo" loading="lazy">

    <!-- Barra de Progreso -->
        <div class="progress-bar">
            <div class="progress-step completed">
                <div class="progress-step-circle">‚úì</div>
                <div class="progress-step-label">Categor√≠a</div>
            </div>
            <div class="progress-step completed">
                <div class="progress-step-circle">‚úì</div>
                <div class="progress-step-label">S√≠ntomas</div>
            </div>
            <div class="progress-step active">
                <div class="progress-step-circle">3</div>
                <div class="progress-step-label">Diagn√≥stico</div>
            </div>
        </div>

        <h1>‚úÖ Resultado del Diagn√≥stico</h1>

        {% if sintomas_mostrados %}
        <div style="margin-top: 30px; margin-bottom: 25px; padding: 20px; background-color: #f8f9fa; border-left: 4px solid var(--primary); border-radius: 10px;">
            <h3 style="margin-top: 0; margin-bottom: 15px; color: var(--primary); font-size: 1.1em;">
                üìã S√≠ntomas considerados:
            </h3>
            <ul style="padding-left: 25px; margin-bottom: 0; list-style: none;">
                {% for pregunta in sintomas_mostrados %}
                <li style="margin-bottom: 8px; position: relative; padding-left: 10px;">
                    <span style="color: var(--primary); position: absolute; left: -15px;">‚ñ™</span>
                    {{ pregunta }}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="resultado">
            <h2>üîç Diagn√≥stico</h2>
            <p style="font-size: 1.05em; line-height: 1.8;">{{ diagnostico }}</p>
        </div>

        <!-- Botones de acci√≥n -->
        <button onclick="window.print()" class="btn" style="margin-top: 30px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            üñ®Ô∏è Imprimir Diagn√≥stico
        </button>
        
        <button onclick="copyDiagnostic()" class="btn btn-secondary" style="margin-top: 10px;">
            üìã Copiar al Portapapeles
        </button>

        <a href="/" class="btn" style="margin-top: 10px;">üîÑ Realizar Otro Diagn√≥stico</a>
        <a href="/otro-problema" class="btn btn-secondary" style="margin-top: 10px;">üìù Detallar Otro Problema</a>

        <!-- Mensaje de confirmaci√≥n de copia -->
        <div id="copy-notification" style="display: none; margin-top: 15px; padding: 12px; background-color: rgba(37, 99, 235, 0.10); border: 2px solid var(--primary); border-radius: 8px; color: var(--primary); font-weight: bold; text-align: center;">
            ‚úÖ Diagn√≥stico copiado al portapapeles
        </div>
    </div>

    <!-- Datos para JavaScript (sin sintaxis Jinja dentro del script) -->
    <div id="diagnostic-data" style="display: none;"
         data-diagnostico="{{ diagnostico }}"
         data-sintomas='{% if sintomas_mostrados %}{{ sintomas_mostrados | tojson }}{% else %}[]{% endif %}'>
    </div>

    <script>
    function copyDiagnostic() {
        // Obtener datos del elemento oculto
        const dataElement = document.getElementById('diagnostic-data');
        const diagnostico = dataElement.getAttribute('data-diagnostico');
        const sintomasJson = dataElement.getAttribute('data-sintomas');
        
        // Construir el texto completo del diagn√≥stico
        let textToCopy = "=== DIAGN√ìSTICO DE PC ===\n\n";
        
        try {
            const sintomas = JSON.parse(sintomasJson);
            if (sintomas && sintomas.length > 0) {
                textToCopy += "S√çNTOMAS CONSIDERADOS:\n";
                sintomas.forEach(function(pregunta) {
                    textToCopy += "‚Ä¢ " + pregunta + "\n";
                });
                textToCopy += "\n";
            }
        } catch (e) {
            console.error('Error parsing sintomas:', e);
        }
        
        textToCopy += "DIAGN√ìSTICO:\n" + diagnostico + "\n\n";
        textToCopy += "=========================\n";
        textToCopy += "Generado por Sistema Experto de Diagn√≥stico PC";

        // Copiar al portapapeles
        navigator.clipboard.writeText(textToCopy).then(function() {
            // Mostrar notificaci√≥n de √©xito
            const notification = document.getElementById('copy-notification');
            notification.style.display = 'block';
            
            // Ocultar despu√©s de 3 segundos
            setTimeout(function() {
                notification.style.display = 'none';
            }, 3000);
        }).catch(function(err) {
            alert('Error al copiar: ' + err);
        });
    }

    // Estilos de impresi√≥n
    const style = document.createElement('style');
    style.textContent = `
        @media print {
            body {
                background: white !important;
                padding: 20px;
            }
            .container {
                box-shadow: none !important;
                padding: 0;
            }
            .progress-bar, button, a, #copy-notification {
                display: none !important;
            }
            .resultado {
                border: 2px solid var(--primary);
                page-break-inside: avoid;
            }
        }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>