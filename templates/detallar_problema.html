<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detallar Otro Problema</title>
    <link rel="stylesheet" href="/static/styles.css?v=2.4">
</head>
<body>
    <div class="container">
        <!-- Logo SmartSolve en esquina -->
        <img src="/imgs/SmartSolve.jpeg" alt="SmartSolve" class="corner-logo" loading="lazy">
        <h1>üìù Describe tu Problema</h1>

        {% if mensaje_exito %}
            <div class="mensaje-exito">
                <p style="margin: 0; font-size: 1.1em;">‚úÖ {{ mensaje_exito }}</p>
                <p style="margin-top: 10px; margin-bottom: 0; font-weight: normal; font-size: 0.95em;">
                    Tu informaci√≥n ha sido registrada y ser√° revisada para mejorar el sistema.
                </p>
            </div>
            
            {% if es_urgente and numero_soporte %}
            <div style="margin-top: 20px; padding: 20px; background-color: rgba(239, 68, 68, 0.1); border: 2px solid #ef4444; border-radius: 10px;">
                <h3 style="color: #ef4444; margin-bottom: 10px; text-align: center;">üìû Contacto de Soporte T√©cnico</h3>
                <p style="text-align: center; color: #333; margin-bottom: 10px;">
                    Has marcado este problema como urgente. Puedes contactar directamente a nuestro equipo t√©cnico:
                </p>
                <p style="text-align: center; font-size: 1.3em; font-weight: bold; color: #ef4444; margin: 0;">
                    {{ numero_soporte }}
                </p>
            </div>
            {% endif %}
        {% else %}
            <p style="text-align: center; color: #666; margin-bottom: 30px;">
                Si no encontraste los s√≠ntomas adecuados, por favor describe el problema lo m√°s detalladamente posible. 
                Tu retroalimentaci√≥n nos ayuda a mejorar el sistema.
            </p>
            
            <form action="/registrar-otro-problema" method="post" id="problem-form">
                <div class="form-group">
                    <label for="categoria_otro">üè∑Ô∏è Categor√≠a del problema:</label>
                    <select name="categoria_otro" id="categoria_otro" required>
                        <option value="" disabled selected>-- Selecciona una categor√≠a --</option>
                        {% for cat in categorias %}
                        <option value="{{ cat }}">{% if cat == 'hardware' %}üîß{% else %}üíª{% endif %} {{ cat.capitalize() }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="descripcion">üìÑ Descripci√≥n detallada:</label>
                    <textarea name="descripcion" id="descripcion" placeholder="Describe qu√© ocurre, cu√°ndo empez√≥, qu√© has intentado hacer, mensajes de error que aparecen, etc." required></textarea>
                    <div style="text-align: right; margin-top: 5px; font-size: 0.85em; color: #888;">
                        <span id="char-count">0</span> caracteres
                    </div>
                </div>
                
                <div class="form-group" style="display: flex; align-items: center; gap: 10px; padding: 15px; background-color: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
                    <input type="checkbox" name="urgente" id="urgente" value="true" style="width: 24px; height: 24px; accent-color: #ef4444; cursor: pointer;">
                    <label for="urgente" style="margin: 0; cursor: pointer; font-weight: 600; color: #856404;">
                        ‚ö†Ô∏è Este problema necesita atenci√≥n urgente
                    </label>
                </div>
                
                <button type="submit" class="btn-warning">üì§ Enviar Descripci√≥n</button>
            </form>
        {% endif %}

        <a href="/" class="btn btn-secondary" style="margin-top: 20px;">‚¨ÖÔ∏è Volver al Inicio</a>
    </div>

    <script>
    // Contador de caracteres para el textarea
    const textarea = document.getElementById('descripcion');
    const charCount = document.getElementById('char-count');
    
    if (textarea && charCount) {
        textarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
    }

    // Confirmaci√≥n antes de enviar
    const form = document.getElementById('problem-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const descripcion = textarea.value.trim();
            if (descripcion.length < 20) {
                e.preventDefault();
                alert('‚ö†Ô∏è Por favor, proporciona una descripci√≥n m√°s detallada (al menos 20 caracteres).');
                return false;
            }
        });
    }
    </script>
</body>
</html>