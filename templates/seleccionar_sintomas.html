<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico PC - S√≠ntomas de {{ categoria }}</title>
    <link rel="stylesheet" href="/static/styles.css?v=2.4">
</head>
<body>
    <div class="container">
    <!-- Logo SmartSolve en esquina -->
    <img src="/imgs/SmartSolve.jpeg" alt="SmartSolve" class="corner-logo" loading="lazy">

    <!-- Barra de Progreso -->
        <div class="progress-bar">
            <div class="progress-step completed">
                <div class="progress-step-circle">‚úì</div>
                <div class="progress-step-label">Categor√≠a</div>
            </div>
            <div class="progress-step active">
                <div class="progress-step-circle">2</div>
                <div class="progress-step-label">S√≠ntomas</div>
            </div>
            <div class="progress-step">
                <div class="progress-step-circle">3</div>
                <div class="progress-step-label">Diagn√≥stico</div>
            </div>
        </div>

        <h1>{% if categoria == 'Hardware' %}üîß{% else %}üíª{% endif %} S√≠ntomas de {{ categoria }}</h1>
        
        <!-- Contador de selecci√≥n -->
        <div class="selection-counter" id="counter">
            <span id="count">0</span> s√≠ntoma(s) seleccionado(s)
        </div>

        <form action="/diagnostico" method="post" id="diagnostic-form">
            <h2>Selecciona los s√≠ntomas presentes:</h2>
            <div class="symptom-grid">
                {% for hecho in hechos %}
                <div class="symptom-item" onclick="toggleCheckbox('{{ hecho.id }}')">
                    <input type="checkbox" name="sintomas_seleccionados" value="{{ hecho.id }}" id="{{ hecho.id }}" onclick="event.stopPropagation();">
                    <label for="{{ hecho.id }}">{{ hecho.pregunta }}</label>
                </div>
                {% endfor %}
            </div>
            
            <div id="error-message" style="color: #f5576c; margin-top: 15px; padding: 12px; text-align: center; font-weight: bold; display: none; background-color: rgba(245, 87, 108, 0.1); border-radius: 8px; border: 2px solid #f5576c;">
                ‚ö†Ô∏è Por favor, selecciona al menos un s√≠ntoma.
            </div>
            
            <button type="submit">üîç Obtener Diagn√≥stico</button>
        </form>
        
        <a href="/" class="btn btn-secondary" style="margin-top: 15px;">‚¨ÖÔ∏è Volver a Categor√≠as</a>
        <a href="/otro-problema" class="btn btn-secondary" style="margin-top: 10px;">üìù ¬øTu problema no est√° aqu√≠? Descr√≠belo</a>
    </div>

    <!-- Loading Spinner -->
    <div class="spinner-overlay" id="spinner">
        <div class="spinner"></div>
    </div>

    <script>
    // Funci√≥n para alternar checkbox al hacer clic en el div completo
    function toggleCheckbox(id) {
        const checkbox = document.getElementById(id);
        checkbox.checked = !checkbox.checked;
        updateCounter();
        updateItemStyles();
    }

    // Actualizar contador de s√≠ntomas seleccionados
    function updateCounter() {
        const checkedSymptoms = document.querySelectorAll('input[name="sintomas_seleccionados"]:checked');
        document.getElementById('count').textContent = checkedSymptoms.length;
    }

    // Actualizar estilos visuales de items seleccionados
    function updateItemStyles() {
        const items = document.querySelectorAll('.symptom-item');
        items.forEach(item => {
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (checkbox.checked) {
                item.classList.add('selected');
            } else {
                item.classList.remove('selected');
            }
        });
    }

    // Validaci√≥n del formulario
    const form = document.getElementById('diagnostic-form');
    const errorMessageDiv = document.getElementById('error-message');
    const spinner = document.getElementById('spinner');

    form.addEventListener('submit', function(event) {
        const checkedSymptoms = document.querySelectorAll('input[name="sintomas_seleccionados"]:checked');

        if (checkedSymptoms.length === 0) {
            event.preventDefault();
            errorMessageDiv.style.display = 'block';
            // Scroll suave al mensaje de error
            errorMessageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
            errorMessageDiv.style.display = 'none';
            // Mostrar spinner mientras se procesa
            spinner.style.display = 'flex';
        }
    });

    // Actualizar contador al cargar checkboxes manualmente
    document.querySelectorAll('input[name="sintomas_seleccionados"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            updateCounter();
            updateItemStyles();
            errorMessageDiv.style.display = 'none';
        });
    });

    // Inicializar contador al cargar la p√°gina
    updateCounter();
    updateItemStyles();
    </script>
</body>
</html>